:root{
      --ui-bg: #f7f8fa;
      --muted: #7b8190;
      --accent: #2563eb;
      --accent-gradient: linear-gradient(90deg,#2563eb 0%,#4f8cff 100%);
      --success: #10b981;
      --danger: #ef4444;
      --panel-bg: rgba(255,255,255,0.82);
      --panel-blur: blur(12px);
      --shadow: 0 8px 32px rgba(0,0,0,0.10), 0 1.5px 4px rgba(0,0,0,0.04);
      --radius: 18px;
      --transition: .18s cubic-bezier(.4,0,.2,1);
      --font: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
    }
    html,body{
      height:100%;margin:0;
      font-family:var(--font);
      background: linear-gradient(120deg, #e0e7ff 0%, #f7f8fa 100%);
      font-size: 16px;
      color: #23272f;
      transition: background .4s;
    }
    #app{display:grid;grid-template-rows:auto 1fr;height:100%}
    header{
      display:flex;align-items:center;gap:12px;
      padding:14px 24px 10px 24px;
      border-bottom:1px solid #e5e7eb;
      position:sticky;top:0;background:var(--ui-bg);z-index:1400;height:60px;
      box-shadow:0 2px 12px rgba(0,0,0,0.04);
      backdrop-filter: blur(8px);
      transition: background var(--transition), box-shadow var(--transition);
    }
    header h1{
      font-size:20px;margin:0;font-weight:700;letter-spacing:-.5px;
      color:var(--accent);
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .spacer{flex:1}
    #map{width:100%;height:100%}

    .icon-btn{
      display:inline-flex;align-items:center;gap:8px;
      border:none;background:transparent;
      padding:8px 10px;border-radius:12px;cursor:pointer;
      transition: background var(--transition), box-shadow var(--transition), transform .12s;
      box-shadow: none;
    }
    .icon-btn img{width:22px;height:22px;display:block}
    .icon-btn:hover{
      background:rgba(37,99,235,0.08);
      box-shadow:0 2px 8px rgba(37,99,235,0.08);
      transform: translateY(-1px) scale(1.04);
    }
    .icon-btn:active{transform:scale(.97);}

    .search-wrap{
      display:flex;gap:10px;align-items:center;margin-left:8px;
      background:rgba(255,255,255,0.7);
      border-radius:14px;
      box-shadow:0 2px 8px rgba(37,99,235,0.06);
      padding:2px 8px;
      backdrop-filter: blur(8px);
    }
    #searchInput{
      width:320px;max-width:40vw;
      padding:10px 14px;
      border-radius:12px;
      border:1.5px solid #e0e7ef;
      font-size:15px;
      background:rgba(255,255,255,0.88);
      transition: border var(--transition), box-shadow var(--transition);
      box-shadow:0 1.5px 6px rgba(37,99,235,0.04);
    }
    #searchInput:focus{
      outline:none;
      border-color:var(--accent);
      box-shadow:0 2px 8px rgba(37,99,235,0.10);
    }
    #searchBtn{
      padding:10px 18px;
      border-radius:12px;
      border:none;
      background:var(--accent-gradient);
      color:#fff;
      font-weight:600;
      font-size:15px;
      cursor:pointer;
      box-shadow:0 2px 8px rgba(37,99,235,0.10);
      transition: background var(--transition), box-shadow var(--transition), transform .12s;
    }
    #searchBtn:hover{background:linear-gradient(90deg,#1d4ed8 0%,#60a5fa 100%);transform:translateY(-1px) scale(1.04);}
    #searchBtn:active{transform:scale(.97);}
    #searchResults{
      position:absolute;top:72px;left:24px;
      width:380px;max-width:calc(100% - 48px);
      background:rgba(255,255,255,0.98);
      border:1.5px solid #e0e7ef;
      border-radius:16px;
      box-shadow:0 12px 32px rgba(37,99,235,0.10);
      z-index:1500;display:none;max-height:340px;overflow:auto;
      animation: fadeIn .22s;
      backdrop-filter: blur(10px);
    }
    .search-item{
      padding:12px 16px;
      border-bottom:1px solid #f2f4fa;
      cursor:pointer;
      transition: background var(--transition);
      font-size:15px;
    }
    .search-item:hover{background:rgba(37,99,235,0.07);}

    .panel{
      position:absolute;top:96px;left:24px;
      width:340px;max-width:calc(100% - 48px);
      background:var(--panel-bg);
      border:1.5px solid #e0e7ef;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      z-index:1350;overflow:hidden;display:none;
      backdrop-filter: var(--panel-blur);
      animation: fadeIn .22s;
      transition: box-shadow var(--transition), background var(--transition);
    }
    .panel header{
      border-bottom:1.5px solid #f0f2f7;
      padding:14px 18px 10px 18px;
      background:transparent;
      font-size:16px;
      font-weight:700;
      color:var(--accent);
      letter-spacing:-.2px;
    }
    .content{padding:18px;display:grid;gap:14px}
    input,textarea,select{
      width:100%;padding:10px 14px;
      border-radius:12px;
      border:1.5px solid #e0e7ef;
      font-size:15px;
      background:rgba(255,255,255,0.93);
      transition: border var(--transition), box-shadow var(--transition);
      box-shadow:0 1.5px 6px rgba(37,99,235,0.03);
    }
    input:focus,textarea:focus,select:focus{
      outline:none;
      border-color:var(--accent);
      box-shadow:0 2px 8px rgba(37,99,235,0.10);
    }
    textarea{min-height:72px}
    .actions{display:flex;gap:10px}
    button{cursor:pointer}
    .btn{
      border:none;
      border-radius:12px;
      padding:10px 18px;
      font-size:15px;
      font-weight:600;
      transition: background var(--transition), box-shadow var(--transition), transform .12s;
      box-shadow:0 1.5px 6px rgba(37,99,235,0.04);
    }
    .btn-primary{
      background:var(--accent-gradient);
      color:#fff;
    }
    .btn-primary:hover{background:linear-gradient(90deg,#1d4ed8 0%,#60a5fa 100%);}
    .btn-secondary{
      background:#6b7280;
      color:#fff;
    }
    .btn-secondary:hover{background:#374151;}
    .btn-ghost{
      background:rgba(37,99,235,0.07);
      color:var(--accent);
    }
    .btn-ghost:hover{background:rgba(37,99,235,0.13);}
    .hint{font-size:13px;color:var(--muted);}
    .legend{
      position:absolute;bottom:24px;right:24px;
      background:rgba(255,255,255,0.92);
      border:1.5px solid #e0e7ef;
      border-radius:14px;
      padding:14px 18px;
      font-size:14px;
      z-index:900;
      box-shadow:0 2px 12px rgba(37,99,235,0.08);
      backdrop-filter: blur(8px);
      animation: fadeIn .22s;
    }
    .legend .bar{
      height:12px;width:200px;
      background:linear-gradient(90deg,#ffff00 0%,#ff0000 100%);
      border-radius:8px;margin-top:8px;
      box-shadow:0 1.5px 6px rgba(37,99,235,0.04);
    }
    .radius-row{display:flex;gap:10px;align-items:center}
    .range{flex:1}
    .progress{
      height:10px;background:#e0e7ef;
      border-radius:8px;overflow:hidden;
      margin-bottom:4px;
    }
    .progress .fill{
      height:100%;width:0%;
      background:linear-gradient(90deg,#ffff00,#ff0000);
      transition: width .18s cubic-bezier(.4,0,.2,1);
    }
    .leaflet-top.leaflet-right .leaflet-control{z-index:1150}
    .leaflet-control-locate{
      background:rgba(255,255,255,0.92);
      padding:8px;
      border-radius:12px;
      box-shadow:0 2px 8px rgba(37,99,235,0.08);
      backdrop-filter: blur(8px);
      transition: box-shadow var(--transition);
    }
    .locate-btn{
      border:none;background:transparent;
      font-size:18px;padding:8px 10px;cursor:pointer;
      border-radius:8px;
      transition: background var(--transition);
    }
    .locate-btn img{width:20px;height:20px;display:block}
    .locate-btn:hover{background:#f0f4ff;}

    #filterBox{
      position:absolute;top:110px;right:24px;
      background:rgba(255,255,255,0.92);
      border:1.5px solid #e0e7ef;
      border-radius:14px;
      padding:12px 16px;
      z-index:1450;
      box-shadow:0 8px 24px rgba(37,99,235,0.08);
      width:240px;max-width:calc(40vw);
      transition:height var(--transition), width var(--transition), box-shadow var(--transition), background var(--transition);
      backdrop-filter: blur(8px);
      animation: fadeIn .22s;
    }
    #filterHeader{
      display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px
    }
    #filterBody{display:block}
    #filterBox.collapsed{
      height:40px;overflow:hidden;width:54px;padding:8px;
      box-shadow:0 2px 8px rgba(37,99,235,0.04);
      background:rgba(255,255,255,0.85);
    }
    #filterBox.collapsed #filterBody{display:none}
    #filterToggle{
      border:none;background:transparent;
      padding:8px;border-radius:8px;cursor:pointer;
      transition: background var(--transition);
    }
    #filterToggle img{width:20px;height:20px}
    #filterBox label{
      display:flex;align-items:center;gap:8px;font-size:15px;
      padding:4px 0;
      cursor:pointer;
      transition: color var(--transition);
    }
    #filterBox label input[type=checkbox]{
      accent-color: var(--accent);
      width:18px;height:18px;
      margin-right:4px;
      border-radius:6px;
      border:1.5px solid #e0e7ef;
      transition: border var(--transition);
    }

    .vote-btn{
      border-radius:10px;
      padding:8px 12px;
      border:1.5px solid #cbd5e1;
      background:#fff;
      cursor:pointer;
      font-size:14px;
      font-weight:600;
      transition: background var(--transition), color var(--transition), border var(--transition), transform .12s;
      box-shadow:0 1.5px 6px rgba(37,99,235,0.03);
    }
    .vote-btn.upvoted{
      background:var(--success);color:#fff;border-color:#059669;
      transform:scale(1.04);
    }
    .vote-btn.downvoted{
      background:var(--danger);color:#fff;border-color:#b91c1c;
      transform:scale(1.04);
    }
    .vote-btn:hover{background:rgba(37,99,235,0.07);}

    .leaflet-popup-content-wrapper{
      border-radius:18px;
      box-shadow:0 8px 32px rgba(37,99,235,0.13);
      background:rgba(255,255,255,0.97);
      backdrop-filter: blur(8px);
      border:1.5px solid #e0e7ef;
      animation: fadeIn .22s;
    }
    .leaflet-popup-content{
      font-size:15px;
      color:#23272f;
      padding:18px 12px 8px 12px;
      min-width:260px;
      max-width:420px;
    }
    .popup .badge{
      display:inline-block;
      background:var(--accent-gradient);
      color:#fff;
      border-radius:8px;
      padding:2px 10px;
      font-size:13px;
      margin-left:6px;
      font-weight:600;
      letter-spacing:.1px;
    }
    .popup button{
      font-size:14px;
      font-weight:600;
      border-radius:8px;
      padding:7px 12px;
      margin:0 2px;
      transition: background var(--transition), color var(--transition), border var(--transition);
    }
    .popup .btn-ghost{background:rgba(37,99,235,0.07);}
    .popup .btn-ghost:hover{background:rgba(37,99,235,0.13);}

    @keyframes fadeIn{
      from{opacity:0;transform:translateY(16px);}
      to{opacity:1;transform:translateY(0);}
    }

    @media(max-width:900px){
      #searchInput{width:180px}
      .panel{width:96vw;left:2vw}
      #searchResults{left:2vw;width:96vw}
      #filterBox{right:8px;top:120px;width:90vw;max-width:96vw;} /* move filter lower */
      .legend{right:8px;bottom:64px;} /* move legend up to avoid mobile browser bars */
    }
    /* Enhanced mobile responsiveness */
    @media(max-width:600px){
      header{
        flex-wrap:wrap;
        padding:8px 2vw 8px 2vw;
        gap:8px;
        height:auto;
        min-height:54px;
      }
      header h1{
        font-size:17px;
        flex-basis:100%;
        margin-bottom:2px;
      }
      .search-wrap{
        width:100%;
        max-width:100vw;
        margin:0;
        padding:2px 2vw;
        box-sizing:border-box;
      }
      #searchInput{
        width:100%;
        min-width:0;
        max-width:100vw;
        font-size:15px;
        padding:9px 10px;
      }
      #searchBtn{
        padding:9px 12px;
        font-size:15px;
      }
      .spacer{display:none;}
      .icon-btn{
        padding:7px 8px;
        gap:4px;
        margin:0 2px;
      }
      .icon-btn img{width:20px;height:20px;}
      #userEmail{display:none;}
      .btn{padding:9px 12px;font-size:14px;}
      .panel{
        width:98vw;
        left:1vw;
        top:70px;
        max-width:99vw;
        border-radius:12px;
        padding:0;
      }
      .panel header{
        font-size:15px;
        padding:12px 10px 8px 10px;
      }
      .content{padding:12px;gap:10px;}
      input,textarea,select{
        font-size:14px;
        padding:9px 10px;
        border-radius:10px;
      }
      textarea{min-height:56px;}
      .actions{gap:6px;}
      #searchResults{
        left:1vw;
        width:98vw;
        max-width:99vw;
        top:62px;
        border-radius:12px;
        font-size:15px;
      }
      .search-item{padding:10px 12px;}
      #filterBox{
        right:2vw;
        top:120px; /* move filter lower */
        width:98vw;
        max-width:99vw;
        border-radius:12px;
        padding:8px 6px;
        font-size:15px;
      }
      #filterHeader{font-size:14px;}
      .legend{
        right:2vw;
        bottom:64px; /* move legend up to avoid overlap with controls */
        width:90vw;
        min-width:0;
        max-width:99vw;
        border-radius:12px;
        padding:10px 10px;
        font-size:13px;
      }
      .legend .bar{width:100%;min-width:0;}
      .leaflet-popup-content{
        min-width:0;
        max-width:95vw;
        padding:12px 4px 6px 4px;
        font-size:14px;
      }
      .leaflet-popup-content-wrapper{
        border-radius:12px;
        padding:0;
      }
    }

    /* Extra small devices */
    @media(max-width:400px){
      header{padding:4px 1vw 4px 1vw;}
      .panel{width:99vw;left:0.5vw;}
      #searchResults{width:99vw;left:0.5vw;}
      #filterBox{width:99vw;right:0.5vw;top:120px;}
      .legend{width:98vw;right:1vw;bottom:64px;}
    }

    /* Make map fill viewport on mobile */
    html, body, #app, #map{
      min-height:100vh;
      height:100%;
      width:100vw;
      box-sizing:border-box;
    }

    /* Improve touch targets */
    button, .icon-btn, .btn{
      min-height:40px;
      min-width:40px;
      touch-action:manipulation;
    }

    /* Prevent popup overflow on mobile */
    .leaflet-popup-content{
      word-break:break-word;
      overflow-wrap:break-word;
    }

    body.dark-mode{
      background:linear-gradient(120deg,#232946 0%,#181c2a 100%);
      color:#e5e7ef;
    }
    body.dark-mode header,
    body.dark-mode .panel,
    body.dark-mode #filterBox,
    body.dark-mode .legend,
    body.dark-mode .search-wrap,
    body.dark-mode #searchResults,
    body.dark-mode .leaflet-popup-content-wrapper{
      background:rgba(24,28,42,0.96)!important;
      color:#e5e7ef;
      border-color:#2d334d!important;
      box-shadow:0 8px 32px rgba(37,99,235,0.13);
    }
    body.dark-mode input,body.dark-mode textarea,body.dark-mode select{
      background:rgba(36,40,56,0.97)!important;
      color:#e5e7ef;
      border-color:#2d334d;
    }
    body.dark-mode .btn-primary{
      background:linear-gradient(90deg,#3b82f6 0%,#6366f1 100%);
      color:#fff;
    }
    body.dark-mode .btn-secondary{background:#374151;}
    body.dark-mode .btn-ghost{background:rgba(99,102,241,0.10);}
    body.dark-mode .vote-btn{background:#232946;color:#e5e7ef;border-color:#2d334d;}
    body.dark-mode .vote-btn.upvoted{background:var(--success);}
    body.dark-mode .vote-btn.downvoted{background:var(--danger);}
    body.dark-mode .legend .bar{background:linear-gradient(90deg,#facc15 0%,#ef4444 100%);}
